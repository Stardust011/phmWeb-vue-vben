var Oe=Object.defineProperty;var ye=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var ve=(e,a,s)=>a in e?Oe(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,E=(e,a)=>{for(var s in a||(a={}))Re.call(a,s)&&ve(e,s,a[s]);if(ye)for(var s of ye(a))Ce.call(a,s)&&ve(e,s,a[s]);return e};var T=(e,a,s)=>new Promise((c,h)=>{var u=p=>{try{f(s.next(p))}catch(m){h(m)}},l=p=>{try{f(s.throw(p))}catch(m){h(m)}},f=p=>p.done?c(p.value):Promise.resolve(p.value).then(u,l);f((s=s.apply(e,a)).next())});import{_ as Le}from"./FormItem.vue_vue_type_script_lang-34714c02.js";import{_ as Pe,b as Ne,c as Se}from"./BasicForm.vue_vue_type_style_index_0_lang-dcd32d20.js";import{_ as Ve,R as U,D as Q,l as ie,m as re,S as ee,U as G,V as pe,N as Me,r as ke,u as Ie,W as je,X as ge,Y as Fe,c as Te,Z as Ue,f as _e}from"./index.js";import{a8 as _,_ as q,a9 as K,aa as j,a0 as We,ag as Ye,f as ce,R as W,ad as x,E as le,a1 as fe,ac as oe,ae,u as n,g as He,e as X,w as Z,an as Xe,q as me,J as Be,s as qe,d as ze,r as we,k as J,o as Ke,ai as Ge,$ as Je,ab as ue,af as be,ah as de,F as Ze}from"./vue-05cc5022.js";import{d as Qe,h as xe,a as $e}from"./helper-58c0d5a5.js";import{M as z,as as et,ai as tt,aa as nt}from"./antd-5cc557c7.js";import{u as st}from"./uniqBy-341b68e5.js";import{u as ot}from"./index-df264b01.js";function rt(e,a,s,c,h,u){const l=_("Button"),f=_("BasicArrow"),p=_("FormItem"),m=_("a-col");return e.showActionButtonGroup?(q(),K(m,ae(x({key:0},e.actionColOpt)),{default:j(()=>[We("div",{style:Ye([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[ce(p,null,{default:j(()=>[W(e.$slots,"resetBefore"),e.showResetButton?(q(),K(l,x({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:j(()=>[le(fe(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):oe("",!0),W(e.$slots,"submitBefore"),e.showSubmitButton?(q(),K(l,x({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:j(()=>[le(fe(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):oe("",!0),W(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(q(),K(l,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:j(()=>[le(fe(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),ce(f,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):oe("",!0),W(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):oe("",!0)}const at=Ve(Pe,[["render",rt]]);function it(e,a,s){const c=/^\[(.+)\]$/;if(c.test(e)){const h=e.match(c);if(h&&h[1]){const u=h[1].split(",");return a=Array.isArray(a)?a:[a],u.forEach((l,f)=>{ee(s,l.trim(),a[f])}),!0}}}function ct(e,a,s){const c=/^\{(.+)\}$/;if(c.test(e)){const h=e.match(c);if(h&&h[1]){const u=h[1].split(",");return a=U(a)?a:{},u.forEach(l=>{ee(s,l.trim(),a[l.trim()])}),!0}}}function lt({defaultValueRef:e,getSchema:a,formModel:s,getProps:c}){function h(f){var m,F;if(!U(f))return{};const p={};for(const b of Object.entries(f)){let[,r]=b;const[O]=b;if(!O||Q(r)&&r.length===0||ie(r))continue;const $=n(c).transformDateFunc;U(r)&&(r=$==null?void 0:$(r)),Q(r)&&((m=r[0])!=null&&m.format)&&((F=r[1])!=null&&F.format)&&(r=r.map(N=>$==null?void 0:$(N))),re(r)&&(r===""?r=void 0:r=r.trim()),!it(O,r,p)&&!ct(O,r,p)&&ee(p,O,r)}return u(p)}function u(f){const p=n(c).fieldMapToTime;if(!p||!Array.isArray(p))return f;for(const[m,[F,b],r="YYYY-MM-DD"]of p){if(!m||!F||!b)continue;if(!f[m]){Reflect.deleteProperty(f,m);continue}const[O,$]=f[m],[N,A]=Array.isArray(r)?r:[r,r];f[F]=G(O).format(N),f[b]=G($).format(A),Reflect.deleteProperty(f,m)}return f}function l(){const f=n(a),p={};f.forEach(m=>{const{defaultValue:F}=m;pe(F)||(p[m.field]=F,s[m.field]===void 0&&(s[m.field]=F))}),e.value=z(p)}return{handleFormValues:h,initDefault:l}}const H=24;function ft({advanceState:e,emit:a,getProps:s,getSchema:c,formModel:h,defaultValueRef:u}){const l=He(),{realWidthRef:f,screenEnum:p,screenRef:m}=Me(),F=X(()=>{if(!e.isAdvanced)return 0;const A=n(s).emptySpan||0;if(ke(A))return A;if(U(A)){const{span:B=0}=A,S=n(m);return A[S.toLowerCase()]||B||0}return 0}),b=Ie($,30);Z([()=>n(c),()=>e.isAdvanced,()=>n(f)],()=>{const{showAdvancedButton:A}=n(s);A&&b()},{immediate:!0});function r(A,B=0,S=!1){const L=n(f),R=parseInt(A.md)||parseInt(A.xs)||parseInt(A.sm)||A.span||H,D=parseInt(A.lg)||R,M=parseInt(A.xl)||D,t=parseInt(A.xxl)||M;return L<=p.LG?B+=R:L<p.XL?B+=D:L<p.XXL?B+=M:B+=t,S?(e.hideAdvanceBtn=!1,B<=H*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):B>H*2&&B<=H*(n(s).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:B}):B>H*(n(s).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:B}:{isAdvanced:!0,itemColSum:B}}const O=Xe({});function $(){var L;let A=0,B=0;const{baseColProps:S={}}=n(s);for(const R of n(c)){const{show:D,colProps:M}=R;let t=!0;if(je(D)&&(t=D),ie(D)&&(t=D({schema:R,model:h,field:R.field,values:E(E({},n(u)),h)})),t&&(M||S)){const{itemColSum:o,isAdvanced:g}=r(E(E({},S),M),A);A=o||0,g&&(B=A),O[R.field]=g}}(L=l==null?void 0:l.proxy)==null||L.$forceUpdate(),e.actionSpan=B%H+n(F),r(n(s).actionColOptions||{span:H},A,!0),a("advanced-change")}function N(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:N,fieldsIsAdvancedMap:O}}function ut(e,a={}){const s=/^\[(.+)\]$/;if(s.test(e)){const c=e.match(s);if(c&&c[1]){const h=c[1].split(",");if(!h.length)return;const u=[];return h.forEach((l,f)=>{ee(u,f,a[l.trim()])}),u.filter(Boolean).length?u:void 0}}}function dt(e,a={}){const s=/^\{(.+)\}$/;if(s.test(e)){const c=e.match(s);if(c&&c[1]){const h=c[1].split(",");if(!h.length)return;const u={};return h.forEach(l=>{ee(u,l.trim(),a[l.trim()])}),Object.values(u).filter(Boolean).length?u:void 0}}}function pt({emit:e,getProps:a,formModel:s,getSchema:c,defaultValueRef:h,formElRef:u,schemaRef:l,handleFormValues:f}){function p(){return T(this,null,function*(){const{resetFunc:t,submitOnReset:o}=n(a);t&&ie(t)&&(yield t()),n(u)&&(Object.keys(s).forEach(i=>{const d=n(c).find(Y=>Y.field===i),v=(d==null?void 0:d.component)&&Qe.includes(d.component),I=z(h.value[i]);s[i]=v?I||"":I}),me(()=>R()),e("reset",Be(s)),o&&M())})}function m(t){return T(this,null,function*(){const o=n(c).map(v=>v.field).filter(Boolean),g=".",i=o.filter(v=>String(v).indexOf(g)>=0),d=[];o.forEach(v=>{const I=n(c).find(w=>w.field===v);let Y=et(t,v);const te=Reflect.has(t,v);Y=xe(I==null?void 0:I.component,Y);const{componentProps:ne}=I||{};let C=ne;typeof ne=="function"&&(C=C({formModel:n(s)}));const se=ut(v,t)||dt(v,t);if(te||se){const w=se||Y;if(B(v))if(Array.isArray(w)){const k=[];for(const y of w)k.push(y?G(y):null);n(s)[v]=k}else n(s)[v]=w?C!=null&&C.valueFormat?w:G(w):null;else n(s)[v]=w;C!=null&&C.onChange&&(C==null||C.onChange(w)),d.push(v)}else i.forEach(w=>{try{const k=w.split(".").reduce((y,V)=>y[V],t);ge(k)&&(n(s)[w]=n(k),d.push(w))}catch(k){ge(h.value[w])&&(n(s)[w]=z(n(h.value[w])))}})}),S(d).catch(v=>{})})}function F(t){return T(this,null,function*(){const o=z(n(c));if(!t)return;let g=re(t)?[t]:t;re(t)&&(g=[t]);for(const i of g)b(i,o);l.value=o})}function b(t,o){if(re(t)){const g=o.findIndex(i=>i.field===t);g!==-1&&(delete s[t],o.splice(g,1))}}function r(t,o,g=!1){return T(this,null,function*(){const i=z(n(c)),d=i.findIndex(I=>I.field===o),v=U(t)?[t]:t;if(!o||d===-1||g){g?i.unshift(...v):i.push(...v),l.value=i,N(t);return}d!==-1&&i.splice(d+1,0,...v),N(t),l.value=i})}function O(t){return T(this,null,function*(){let o=[];if(U(t)&&o.push(t),Q(t)&&(o=[...t]),!o.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}l.value=o})}function $(t){return T(this,null,function*(){let o=[];if(U(t)&&o.push(t),Q(t)&&(o=[...t]),!o.every(d=>d.component==="Divider"||Reflect.has(d,"field")&&d.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];n(c).forEach(d=>{let v;if(o.forEach(I=>{d.field===I.field&&(v=I)}),v!==void 0&&d.field===v.field){const I=Te(d,v);i.push(I)}else i.push(d)}),N(i),l.value=st(i,"field")})}function N(t){let o=[];U(t)&&o.push(t),Q(t)&&(o=[...t]);const g={},i=A();o.forEach(d=>{d.component!="Divider"&&Reflect.has(d,"field")&&d.field&&!pe(d.defaultValue)&&(!(d.field in i)||pe(i[d.field])||Ue(i[d.field]))&&(g[d.field]=d.defaultValue)}),m(g)}function A(){return n(u)?f(Be(n(s))):{}}function B(t){return n(c).some(o=>o.field===t?$e.includes(o.component):!1)}function S(t){return T(this,null,function*(){var o;return(o=n(u))==null?void 0:o.validateFields(t)})}function L(t){return T(this,null,function*(){var o;return yield(o=n(u))==null?void 0:o.validate(t)})}function R(t){return T(this,null,function*(){var o;yield(o=n(u))==null?void 0:o.clearValidate(t)})}function D(t,o){return T(this,null,function*(){var g;yield(g=n(u))==null?void 0:g.scrollToField(t,o)})}function M(t){return T(this,null,function*(){t&&t.preventDefault();const{submitFunc:o}=n(a);if(o&&ie(o)){yield o();return}if(n(u))try{const i=yield L(),d=f(i);e("submit",d)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}return{handleSubmit:M,clearValidate:R,validate:L,validateFields:S,getFieldsValue:A,updateSchema:$,resetSchema:O,appendSchemaByField:r,removeSchemaByField:F,resetFields:p,setFieldsValue:m,scrollToField:D}}function mt(h){return T(this,arguments,function*({getSchema:e,getProps:a,formElRef:s,isInitedDefault:c}){qe(()=>T(this,null,function*(){if(n(c)||!n(a).autoFocusFirstItem)return;yield me();const u=n(e),l=n(s),f=l==null?void 0:l.$el;if(!l||!f||!u||u.length===0||!u[0].component.includes("Input"))return;const m=f.querySelector(".ant-row:first-child input");m&&(m==null||m.focus())}))})}const ht=ze({name:"BasicForm",components:{FormItem:Le,Form:tt,Row:nt,FormAction:at},props:Ne,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:a,attrs:s}){const c=we({}),h=ot(),u=we({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),l=J({}),f=J(!1),p=J({}),m=J(null),F=J(null),{prefixCls:b}=_e("basic-form"),r=X(()=>E(E({},e),n(p))),O=X(()=>[b,{[`${b}--compact`]:n(r).compact}]),$=X(()=>{const{baseRowStyle:y={},rowProps:V}=n(r);return E({style:y},V)}),N=X(()=>E(E(E({},s),e),n(r))),A=X(()=>{const y=n(m)||n(r).schemas;for(const V of y){const{defaultValue:P,component:he,isHandleDateDefaultValue:De=!0}=V;if(De&&P&&$e.includes(he))if(!Array.isArray(P))V.defaultValue=G(P);else{const Ae=[];P.forEach(Ee=>{Ae.push(G(Ee))}),V.defaultValue=Ae}}return n(r).showAdvancedButton?z(y.filter(V=>V.component!=="Divider")):z(y)}),{handleToggleAdvanced:B,fieldsIsAdvancedMap:S}=ft({advanceState:u,emit:a,getProps:r,getSchema:A,formModel:c,defaultValueRef:l}),{handleFormValues:L,initDefault:R}=lt({getProps:r,defaultValueRef:l,getSchema:A,formModel:c});mt({getSchema:A,getProps:r,isInitedDefault:f,formElRef:F});const{handleSubmit:D,setFieldsValue:M,clearValidate:t,validate:o,validateFields:g,getFieldsValue:i,updateSchema:d,resetSchema:v,appendSchemaByField:I,removeSchemaByField:Y,resetFields:te,scrollToField:ne}=pt({emit:a,getProps:r,formModel:c,getSchema:A,defaultValueRef:l,formElRef:F,schemaRef:m,handleFormValues:L});Se({resetAction:te,submitAction:D}),Z(()=>n(r).model,()=>{const{model:y}=n(r);y&&M(y)},{immediate:!0}),Z(()=>n(r).schemas,y=>{v(y!=null?y:[])}),Z(()=>A.value,y=>{me(()=>{var V;(V=h==null?void 0:h.redoModalHeight)==null||V.call(h)}),!n(f)&&y!=null&&y.length&&(R(),f.value=!0)}),Z(()=>c,Ie(()=>{n(r).submitOnChange&&D()},300),{deep:!0});function C(y){return T(this,null,function*(){p.value=Te(n(p)||{},y)})}function se(y,V,P){c[y]=V,a("field-value-change",y,V),P&&P.itemProps&&!P.itemProps.autoLink&&g([y]).catch(he=>{})}function w(y){const{autoSubmitOnEnter:V}=n(r);if(V&&y.key==="Enter"&&y.target&&y.target instanceof HTMLElement){const P=y.target;P&&P.tagName&&P.tagName.toUpperCase()=="INPUT"&&D()}}const k={getFieldsValue:i,setFieldsValue:M,resetFields:te,updateSchema:d,resetSchema:v,setProps:C,removeSchemaByField:Y,appendSchemaByField:I,clearValidate:t,validateFields:g,validate:o,submit:D,scrollToField:ne};return Ke(()=>{R(),a("register",k)}),E({getBindValue:N,handleToggleAdvanced:B,handleEnterPress:w,formModel:c,defaultValueRef:l,advanceState:u,getRow:$,getProps:r,formElRef:F,getSchema:A,formActionType:k,setFormModel:se,getFormClass:O,getFormActionBindProps:X(()=>E(E({},r.value),u)),fieldsIsAdvancedMap:S},k)}});function At(e,a,s,c,h,u){const l=_("FormItem"),f=_("FormAction"),p=_("Row"),m=_("Form");return q(),K(m,x(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:Ge(e.handleEnterPress,["enter"])}),{default:j(()=>[ce(p,ae(de(e.getRow)),{default:j(()=>[W(e.$slots,"formHeader"),(q(!0),Je(Ze,null,ue(e.getSchema,F=>(q(),K(l,{key:F.field,isAdvanced:e.fieldsIsAdvancedMap[F.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:F,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},be({_:2},[ue(Object.keys(e.$slots),b=>({name:b,fn:j(r=>[W(e.$slots,b,ae(de(r||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),ce(f,x(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),be({_:2},[ue(["resetBefore","submitBefore","advanceBefore","advanceAfter"],F=>({name:F,fn:j(b=>[W(e.$slots,F,ae(de(b||{})))])}))]),1040,["onToggleAdvanced"]),W(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}const Tt=Ve(ht,[["render",At]]);export{Tt as B};
